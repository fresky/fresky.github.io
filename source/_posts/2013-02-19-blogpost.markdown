---
layout: post
title: "C#的static constructor抛了异常会怎么处理？"
date: 2013-02-19
comments: true
categories: 
---
<p><a href="http://stackoverflow.com/questions/4737875/exception-in-static-constructor/4737910#4737910">stackoverflow</a>上举了这个例子说明在C#中，如果static constructor只会被调用一次，即使抛了异常，也不会重试调用。如果抛了异常，那么在这个appdomain里面，这个类就不能用了。</p>  <p>示例代码：</p>  <div style="border-bottom: #cccccc 1px solid; border-left: #cccccc 1px solid; padding-bottom: 5px; background-color: #f5f5f5; padding-left: 5px; padding-right: 5px; border-top: #cccccc 1px solid; border-right: #cccccc 1px solid; padding-top: 5px" class="cnblogs_code">   <pre><span style="color: #0000ff">using</span><span style="color: #000000"> System;

</span><span style="color: #0000ff">public</span> <span style="color: #0000ff">sealed</span> <span style="color: #0000ff">class</span><span style="color: #000000"> Bang
{
    </span><span style="color: #0000ff">static</span><span style="color: #000000"> Bang()
    {
        Console.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">In static constructor</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
        </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> Exception(<span style="color: #800000">&quot;</span><span style="color: #800000">Bang!</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
    }

    </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Foo() {}
}

</span><span style="color: #0000ff">class</span><span style="color: #000000"> Test
{
    </span><span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Main()
    {
        </span><span style="color: #0000ff">for</span> (<span style="color: #0000ff">int</span> i = <span style="color: #800080">0</span>; i &lt; <span style="color: #800080">5</span>; i++<span style="color: #000000">)
        {
            </span><span style="color: #0000ff">try</span><span style="color: #000000">
            {
                Bang.Foo();
            }
            </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception e)
            {
                Console.WriteLine(e.GetType().Name);
            }
        }
    }
}</span></pre>
</div>



<p>输出如下：</p>

<div style="border-bottom: #cccccc 1px solid; border-left: #cccccc 1px solid; padding-bottom: 5px; background-color: #f5f5f5; padding-left: 5px; padding-right: 5px; border-top: #cccccc 1px solid; border-right: #cccccc 1px solid; padding-top: 5px" class="cnblogs_code">
  <pre><span style="color: #000000">In static constructor
TypeInitializationException
TypeInitializationException
TypeInitializationException
TypeInitializationException
TypeInitializationException</span></pre>
</div>