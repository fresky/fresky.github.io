---
layout: post
title: "C#的一个小函数来计算一个运算使用的时间和内存"
date: 2013-06-08
comments: true
categories: 
---
<p>&#160;</p>  <p>如下，分别计算时间和内存。</p>  <div style="border-bottom: #cccccc 1px solid; border-left: #cccccc 1px solid; padding-bottom: 5px; background-color: #f5f5f5; padding-left: 5px; padding-right: 5px; border-top: #cccccc 1px solid; border-right: #cccccc 1px solid; padding-top: 5px" class="cnblogs_code">   <pre><span style="color: #0000ff">        public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">double</span><span style="color: #000000"> TimeWatcher(Action action)
        {
            System.Diagnostics.Stopwatch watch </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> System.Diagnostics.Stopwatch();
            watch.Start();
            action();
            watch.Stop();
            </span><span style="color: #0000ff">var</span> useTime = (<span style="color: #0000ff">double</span>) watch.ElapsedMilliseconds/<span style="color: #800080">1000</span><span style="color: #000000">;
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> useTime;
        }

        </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">long</span><span style="color: #000000"> MemoryWatcher(Action action)
        {
            </span><span style="color: #0000ff">long</span> start = GC.GetTotalMemory(<span style="color: #0000ff">true</span><span style="color: #000000">);
            action();
            GC.Collect();
            GC.WaitForFullGCComplete();
            </span><span style="color: #0000ff">long</span> end = GC.GetTotalMemory(<span style="color: #0000ff">true</span><span style="color: #000000">);
            </span><span style="color: #0000ff">long</span> useMemory = (end - start)/(<span style="color: #800080">1024</span>*<span style="color: #800080">1024</span><span style="color: #000000">);
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> useMemory;
        }</span></pre>
</div>