---
layout: post
title: "Windows Live Writer的一个代码语法高亮的插件——CodeInLiveWriter"
date: 2013-06-09
comments: true
categories: 
---
<p>&nbsp;</p>
<p>我平时经常用<a href="http://windows.microsoft.com/en-us/windows-live/essentials-other#essentials=overviewother">Windows Live Writer</a>来写博客，但是插入代码很麻烦，用了一些插件也都有些不满意的地方，我就自己写了一个，可以从<a href="http://msdn.microsoft.com/en-us/library/aa702851.aspx">这里</a>找到如何给Windows Live Writer写plugin。</p>
<p>我这个程序基于<a href="http://hilite.me/">hilite.me</a>提供的<a href="http://hilite.me/api">API</a>，hilite.me内部使用了<a href="http://pygments.org/">Pygments</a>，<a href="http://pygments.org/">Pygments</a>也被用于github的代码显示。</p>
<p>另外<a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>也是个被广泛应用的代码高亮的工具。</p>
<p>&nbsp;</p>
<p>使用方法：</p>
<p>下载<a href="https://github.com/fresky/CodeInLiveWriter/blob/master/CodeInLiveWriter.dll">CodeInLiveWriter.dll</a>，然后放在<em>[WindowsLiveWriterPath]\Plugins\</em>目录下就行了。源代码放在了<a href="https://github.com/fresky/CodeInLiveWriter" target="_blank">GitHub</a>上。</p>
<p>&nbsp;</p>
<p><strong>目前内建可选的语言有：</strong></p>
<ul>
<li>c#</li>
<li>c++</li>
<li>java</li>
<li>python</li>
<li>ruby</li>
<li>c</li>
<li>sql</li>
<li>html</li>
<li>xml</li>
<li>batch</li>
<li>bash</li>
</ul>
<p><strong>内建支持的格式：</strong></p>
<ul>
<li>vs</li>
<li>colorful</li>
<li>emacs</li>
<li>vim</li>
</ul>
<p>支持用户自定义语言和格式，分别存在 <strong>CodeInLiveWriterStyle.txt</strong> 和 <strong>CodeInLiveWriterLanguage.txt</strong>，然后和<strong>CodeInLiveWriter.dll</strong>放在同一个文件夹下。具体参见<a href="http://pygments.org/">Pygments</a>支持的<a href="http://pygments.org/docs/lexers/">语言</a> and <a href="http://pygments.org/docs/styles/">格式</a>。</p>
<p>&nbsp;</p>
<p>主要的代码如下：（就是用这个插件把代码插进来的：））</p>
<div style="border-bottom: gray 0.1em solid; border-left: gray 0.8em solid; padding-bottom: 0.2em; padding-left: 0.6em; width: auto; padding-right: 0.6em; background: #ffffff; overflow: auto; border-top: gray 0.1em solid; border-right: gray 0.1em solid; padding-top: 0.2em;">
<table>
<tbody>
<tr>
<td>
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre>
</td>
<td>
<pre><span style="color: #0000ff;">        private</span> <span style="color: #2b91af;">string</span> getHtmlStyleCode(<span style="color: #2b91af;">string</span> language, <span style="color: #2b91af;">string</span> code, <span style="color: #2b91af;">bool</span> showline, <span style="color: #2b91af;">string</span> style)
        {
            <span style="color: #0000ff;">try</span>
            {
                HttpWebRequest httpWebRequest = WebRequest.Create(<span style="color: #a31515;">"http://hilite.me/api"</span>) <span style="color: #0000ff;">as</span> HttpWebRequest;
                httpWebRequest.Method = <span style="color: #a31515;">"POST"</span>;
                httpWebRequest.ContentType = <span style="color: #a31515;">"application/x-www-form-urlencoded"</span>;

                <span style="color: #2b91af;">string</span> parameters = <span style="color: #2b91af;">string</span>.Format(<span style="color: #a31515;">"lexer={0}&amp;code={1}&amp;{2}&amp;style={3}"</span>,
                                                  HttpUtility.UrlEncode(language),
                                                  HttpUtility.UrlEncode(code),
                                                  showline ? <span style="color: #a31515;">"&amp;linenos=1"</span> : <span style="color: #a31515;">""</span>,
                                                  style);

                <span style="color: #0000ff;">using</span> (StreamWriter streamWriter = <span style="color: #0000ff;">new</span> StreamWriter(httpWebRequest.GetRequestStream()))
                {
                    streamWriter.Write(parameters);
                }
                <span style="color: #2b91af;">string</span> result;
                <span style="color: #0000ff;">using</span> (WebResponse response = httpWebRequest.GetResponse())
                {
                    <span style="color: #0000ff;">using</span> (StreamReader streamReader = <span style="color: #0000ff;">new</span> StreamReader(response.GetResponseStream()))
                    {
                        result = streamReader.ReadToEnd();
                    }
                }
                <span style="color: #0000ff;">return</span> result;
            }
            <span style="color: #0000ff;">catch</span>
            {
                <span style="color: #0000ff;">return</span> code;
            }
        }</pre>
</td>
</tr>
</tbody>
</table>
</div>