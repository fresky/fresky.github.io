---
layout: post
title: "TPL中的task并不是thread"
date: 2013-07-08
comments: true
categories: 
---
<p><a href="http://blogs.msdn.com/b/benwilli/archive/2013/04/24/tasks-are-not-threads.aspx">Tasks are not Threads - The Brain Dump</a>用了一个非常简单直观的例子说明了task和thread并不是一回事（尽管你调用Task.Run一般会在线程池上启一个线程帮你做些事情）。</p>  <p>假设有个UI，我们有2个按钮，开始和结束。代码如下：</p>  <div style="border-bottom: gray 0.1em solid; border-left: gray 0.8em solid; padding-bottom: 0.2em; padding-left: 0.6em; width: auto; padding-right: 0.6em; background: #ffffff; overflow: auto; border-top: gray 0.1em solid; border-right: gray 0.1em solid; padding-top: 0.2em">   <table><tbody>       <tr>         <td>           <pre style="line-height: 125%; margin: 0px"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
        </td>

        <td>
          <pre style="line-height: 125%; margin: 0px"><span style="color: #0000ff">private</span> <span style="color: #0000ff">async</span> <span style="color: #0000ff">void</span> bttnStart_Click(<span style="color: #2b91af">object</span> sender, RoutedEventArgs e)
{
    MessageBox.Show(<span style="color: #a31515">&quot;Looking for the time&quot;</span>);
    DateTime now = <span style="color: #0000ff">await</span> GetCurrentTimeAsync();
    MessageBox.Show(<span style="color: #a31515">&quot;It is now&quot;</span> + now.ToString());
}

<span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> bttnEnd_Click(<span style="color: #2b91af">object</span> sender, RoutedEventArgs e)
{
    <span style="color: #0000ff">if</span> (_tsc != <span style="color: #0000ff">null</span>)
    {
        _tsc.SetResult(DateTime.Now);
    }
}

TaskCompletionSource&lt;DateTime&gt; _tsc;

<span style="color: #0000ff">private</span> Task&lt;DateTime&gt; GetCurrentTimeAsync()
{
    _tsc = <span style="color: #0000ff">new</span> TaskCompletionSource&lt;DateTime&gt;();
    <span style="color: #0000ff">return</span> _tsc.Task;
}</pre>
        </td>
      </tr>
    </tbody></table>
</div>

<p>从上面的代码我们可以看到，这个task的开始于用户点击“开始”按钮，介绍于用户点击“结束”按钮。task其实在等用户的操作，同样的，task也可以在等网络，内存或者任何别的东西，不一定是线程。</p>